<!DOCTYPE html>
<html lang="en" >

<head>
  <meta charset="UTF-8">
  <title>Three.js project</title>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://d3js.org/queue.v1.min.js"></script>
  <script type="text/javascript" src="lib/dat.gui.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Righteous" rel="stylesheet">

</head>

<body>

<!--BLACK MAGICS-->
  <!-- STAR FIELD SHADER -->
  <script type="x-shader/x-vertex" id="vertexshader">
    uniform float scale;
    varying vec3 vColor;
    attribute float size;
    void main() {
        vColor = color;
        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
        gl_PointSize = size*(120.0) * ((scale / -mvPosition.z));
        gl_Position = projectionMatrix * mvPosition;
    }
  </script>

  <script type="x-shader/x-fragment" id="fragmentshader">
    uniform sampler2D texture;
    varying vec3 vColor;

    void main() {
        gl_FragColor = vec4( vColor, 1 );
        gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );
    }
  </script>
  <!--STAR SHADER-->
  <script type="x-shader/x-vertex" id="haloShaderVert">
    varying vec2 vUv;

    void main()
    {
      vUv = uv;
      vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
      gl_Position = projectionMatrix * mvPosition;
    }
  </script>

  <script type="x-shader/x-fragment" id="haloShaderFrag">
    #define PI 3.14159265359
    #define TWO_PI 6.28318530718
    #define SQ3 1.73205080757
    #define SIZE 400.0
    #define I_R 100.0
    #define F_R 400.0
    #define SPEED 0.4

    precision highp float;

    precision highp int;
    uniform float time;
    uniform vec2 resolution;
    uniform vec3 color;
    varying vec2 vUv;
    float random(in vec2 _st)
    {
      return fract(sin(dot(_st.xy, vec2(12.9898, 78.233))) * 43758.54531237);
    }
    float noise(in vec2 _st)
    {
      vec2 i = floor(_st);
      vec2 f = fract(_st);
      float a = random(i);
      float b = random(i + vec2(1.0, 0.0));
      float c = random(i + vec2(0.0, 1.0));
      float d = random(i + vec2(1.0, 1.0));
      vec2 u = f * f * (3. - 2.0 * f);
      return mix(a, b, u.x) + (c - a) * u.y * (1. - u.x) + (d - b) * u.x * u.y;
    }
    float noise(float _st)
    {
      return fract(abs(sin(_st)));
    }
    vec4 flare(float alpha, vec2 main, float seed, float dir)
    {

      float amnt = 0.6 + sin(seed) * 8.0;
      float ang = atan(main.y, main.x);
      float t = time * SPEED * dir;
      float n = noise(vec2((seed + ang * amnt + t * 0.1) + cos(alpha * 13.8 + noise(t + ang + seed) * 3.0) * 0.2 + seed / 20.0, seed + t + ang));
      n *= pow(noise(vec2(seed * 194.0 + ang * amnt + t + cos(alpha * 2.0 * n + t * 1.1 + ang) * 2.8, seed + t + ang) + alpha), 2.0);
      n *= pow(noise(vec2(seed * 134.0 + ang * amnt + t + cos(alpha * 2.2 * n + t * 1.1 + ang) * 1.1, seed + t + ang) + alpha), 3.0);
      n *= pow(noise(vec2(seed * 123.0 + ang * amnt + t + cos(alpha * 2.3 * n + t * 1.1 + ang) * 0.8, seed + t + ang) + alpha), 4.0);
      n *= pow(alpha, 2.6);
      n *= (ang + PI) / 2.0 * (TWO_PI - ang - PI);
      n += sqrt(alpha * alpha) * 0.26;
      return vec4(pow(n * 2.1, 2.0), n, n, n);
    }
    void main()
    {
      float size = 600.0;
      vec2 uv = (vUv.xy * size - resolution.xy * size * 0.5) / resolution.y;
      vec4 c = vec4(0.0);
      float len = length(uv);
      float alpha = pow(clamp(F_R - len + I_R - 40.0, 0.0, F_R) / F_R, 6.0);
      c += flare(alpha, uv, 74.621, 1.0);
      c += flare(alpha, uv, 35.1412, 1.0);
      c += flare(alpha, uv, 21.5637, 1.0);
      c += flare(alpha, uv, 1.2637, 1.0);
      c.xyz = clamp(c.xyz, 0.0, 1.0);
      if (alpha >= 0.99)
      {
          c.a = alpha; //middle section trasnsparency
      }
       gl_FragColor = vec4(color, c.a);
    }
  </script>

  <script type="x-shader/x-vertex" id="surfaceShaderVert">
    varying vec2 vUv;
    void main()
    {
      vUv = uv;

      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0 );
      gl_Position = projectionMatrix * mvPosition;
    }
  </script>

  <script type="x-shader/x-vertex" id="surfaceShaderFrag">
    #define PI 3.14159265359
    uniform float time;
    uniform sampler2D iChannel0;

    varying vec2 vUv;
    float scale = 1.5;
    float coreIntensity = 4.0;
    float haloIntensity = 4.5;

    void mainImage(out vec4 fragColor, in vec2 fragCoord)
    {
    	float t = time * 0.05;

    	vec2 uv =  -1.0 + 2.0 *vUv;

    	vec2 dir = -(uv * 2.0 - 1.0) * scale;

    	float z = sqrt(max(0.0, 1.0 - dir.x * dir.x - dir.y * dir.y));
    	float dist = length(dir);

    	vec2 sphereUv = vec2(atan(dir.x, z) / PI + t,
    		         		 asin(dir.y) / PI);

    	float disc = max(0.0, sqrt(max(0.0, z)));
    	float corona = min(1.0 / pow(dist, 3.0), 1.0);

    	vec3 sun = texture(iChannel0, sphereUv).rgb;
    	float lum = dot(sun, vec3(0.25, 0.6, 0.15));
    	float med = mod(t * 1.0, 1.0);

    	float offset = abs(med - lum);
    	float sup = step(offset, 0.5);
    	offset = sup * offset + (1.0 - sup) * (1.0 - offset);

    	vec3 color = max(vec3(0.0), 0.7 * pow(vec3(0.5 * offset, 0.15 * offset, offset) * disc, vec3(1.0 / coreIntensity)));
    	color += 0.65 * vec3(0.65, 0.35, 0.1) * corona * haloIntensity;

    	fragColor = vec4(color, 1.0);
    }
  </script>
<!--BLACK MAGICS END-->
  <div id="Stats-Output">
  </div>
  <!-- Div which will hold the Output -->
  <div id="WebGL-Output">
    <div style="display:none">
			<span id="marker_template" class="marker"><span class="name">
			</span></span>
		</div>
  </div>

  <!--CONTROLS-->
  <button id="return">Return</button>
  <div id="object"></div>
  <div id="coordinates">X ; Y</div>
  <!--MODALS-->
  <div id="name-container"></div>
  <div id="description-container"><!--Object description goes here--></div>


  <script src='https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/89/three.min.js'></script>
  <script src='js/three.js'></script>
  <script src='lib/TrackballControls.js'></script>
  <script src='lib/DeviceOrientationControls.js'></script>
  <script src='js/cameraControls.js'></script>
  <script src='js/galaxy.js'></script>
  <script src='js/constellation.js'></script>
  <script src='js/skybox.js'></script>
  <script src='js/object.js'></script>
  <script src='js/highlight.js'></script>
  <script src='js/return.js'></script>
  <script src='js/helperfunctions.js'></script>
  <script src='js/geolocation.js'></script>
  <script src='js/wikiLookup.js'></script>
  <script src="https://unpkg.com/topojson-client@3"></script>

  <script src='js/index.js'></script>

</body>

</html>
